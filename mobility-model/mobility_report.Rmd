---
output: pdf_document
header-includes:
  - \usepackage{pxfonts} 
params:
  country_code: IT
---

```{r setup, echo=FALSE, include=FALSE}
root_path <- "."

if (!interactive()) {
  source(file.path("renv", "activate.R"))
}

library(magrittr)
library(tidyverse)
library(cowplot)
library(ggridges)
library(haven)
library(latex2exp)
library(rstan)

ggplot2::theme_set(theme_minimal())

knitr::opts_chunk$set(echo = FALSE)
```

```{r}
results <- read_rds(file.path("data", "mobility", "results", "clean", "merged.rds")) %>% 
  filter(fct_match(country_code, params$country_code))

country_name <- results$country_name %>% unique()
```


---
title: `r country_name`
---

```{r R0-plot, fig.width=10}
results %>% 
  plot_subnat_ci() + 
  coord_cartesian(xlim = c(1, 4.5)) +
  labs(title = TeX("R_{0,m}"))
```

```{r mob-plot, fig.height=6, fig.width=12}
results %>% 
  plot_day_data(par = c("g_residential", "g_transit_stations", "average_mob"), use_date = TRUE) +
  labs(title = "Mobility Data") +
  NULL
```

```{r Rt-plot, fig.height=6, fig.width=12}
results %>% 
  plot_day_ci(par = "Rt_adj", use_date = TRUE) +
  geom_hline(yintercept = 1, linetype = "dotted") +
  labs(title = TeX("R_{t,m}")) 
```

```{r last-Rt-plot, fig.height=4, fig.width=10}
results %>% 
  plot_last_day_ci() +
  geom_vline(xintercept = 1, linetype = "dotted") +
  labs(title = TeX("$R_{t,m}$ on the last day")) 
```

```{r in-post-deaths, fig.width=14}
results %>% 
  plot_post_deaths()
```
