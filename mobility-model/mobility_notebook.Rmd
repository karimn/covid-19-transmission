---
title: "R Notebook"
output: html_notebook
---

```{r setup}
library(magrittr)
library(tidyverse)
library(haven)
library(latex2exp)
library(rstan)

source(file.path("..", "util.R"))

ggplot2::theme_set(theme_minimal())
```

# Looking at Data

Just looking at what data is available.

## Mobility Data

```{r}
goog_mob_data <- read_csv(file.path("..", "data", "mobility", "Global_Mobility_Report.csv"), col_types = lst("sub_region_2" = col_character()))
```

## IFR from Vollmer et al.

```{r}
popt_ifr <- read_csv(file.path("..", "..", "covid19model", "data", "popt_ifr.csv"))
```

## Cleaned Data

```{r}
natsubnat_data <- read_dta(file.path("~", "Dropbox", "COVID-19", "Analysis", "Data", "master.dta")) %>% 
  mutate_if(is.labelled, as_factor)
```  

```{r}
natsubnat_data %>% count(subregion)
```

```{r}
subnat_data <- read_dta(file.path("~", "Dropbox", "COVID-19", "Analysis", "Data", "subspread.dta"))
```

# Analysis

```{r}
load(file.path("..", "data", "mobility", "results", "ita_mob_results2.RData"))
```

```{r R0-plot}
use_subnat_data %>% 
  plot_subnat_ci() + 
  coord_cartesian(xlim = c(1, 4.5)) +
  labs(title = TeX("R_0"))
```

```{r Rt-plot, fig.height=10}
use_subnat_data %>% 
  plot_day_ci() +
  geom_hline(yintercept = 1, linetype = "dotted")
  # coord_cartesian(xlim = c(1, 4.5)) +
  # labs(title = TeX("R_0")) +
```

```{r last-Rt-plot, fig.height=10}
use_subnat_data %>% 
  plot_last_day_ci() +
  geom_vline(xintercept = 1, linetype = "dotted")
  # coord_cartesian(xlim = c(1, 4.5)) +
  # labs(title = TeX("R_0")) +
```
